# Архитектурное решение по логированию

**Мотивация**

Сейчас разбор ошибок и инцидентов происходит в основном со слов клиентов и операторов.
Это приводит к долгому поиску причин проблем и высокой нагрузке на поддержку и разработчиков.

Внедрение централизованного логирования необходимо для:
быстрого разбора инцидентов;
восстановления хода событий внутри сервисов;
снижения количества обращений в поддержку;
повышения прозрачности работы системы.

Логирование внедряется на уровне сервисов, участвующих в обработке заказов:
Онлайн-магазин (Shop API)
CRM (CRM API)
MES (MES API)

Базы данных и файловые хранилища напрямую не логируются - операции с ними фиксируются через логи сервисов.

**Предлагаемое решение**
Использование стандартных библиотек логирования (SLF4J / Logback)
Централизованный сбор логов в едином хранилище (ELK-стек)
Сопоставление логов по traceId / spanId с системой трейсинга

**Безопасность логирования**
В логах не хранятся персональные и платёжные данные
Чувствительные поля маскируются
Доступ к логам имеют только сотрудники компании (разработчики и поддержка) с соответствующими правами

**Анализ логов**
Логирование не используется как основной механизм алертинга.
Алерты должны строиться на метриках и событиях ошибок, так как они
лучше подходят для автоматического обнаружения проблем.

Логи применяются для последующего разбора инцидентов:
восстановления последовательности действий,
поиска причины ошибки и понимания контекста произошедшего.

Выявление аномалий (резкий рост количества запросов, операций или ошибок)
выполняется на уровне метрик.
Логи в этом случае используются как дополнительный источник информации
при анализе инцидентов, обнаруженных средствами мониторинга.

**Альтернативное решение**
Graylog

Graylog — open-source платформа централизованного логирования, ориентированная на сбор,
хранение и анализ логов из распределённых систем.

Плюсы:
Централизованный сбор и поиск логов.
Удобный веб-интерфейс для анализа и фильтрации.
Поддержка структурированных логов.

Минусы:

Ограниченные возможности аналитики по сравнению с ELK-стеком.
Меньшая гибкость при работе с большими объёмами логов.
Менее развитая экосистема и интеграции.

Вывод:
Graylog является рабочей альтернативой для централизованного логирования, однако ELK-стек
предоставляет более гибкие возможности анализа и масштабирования и лучше подходит для текущей архитектуры.